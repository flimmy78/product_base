SHELL = /bin/bash

CCFLAGS = -D_DISTRIBUTION_ -D_VERSION_18SP8_
DBUS_LIBS = -ldbus-1

INCLUDES += -I$(ACCAPI_DIR) -I$(BUILDROOTDIR)/usr/include -I$(BUILDROOTDIR)/usr/include/dbus-1.0/ -I$(BUILDROOTDIR)/usr/lib/dbus-1.0/include
INCLUDES += -I../../../dg/dcli/src/lib/
LDFLAGS = -shared -Wl,-soname,$@

LD_PATH = -L${ROOTFS_DIR}/files/lib -L$(BUILDROOTDIR)/usr/lib 


SEM_DBUS_SHLIB_MAJOR = 0
SEM_DBUS_SHLIB_MINOR = 1
SEM_DBUS_OBJS = sem_interface.o
SEM_DBUS_SHLIB_LINKERNAME = libsem_dbus_pub.so
SEM_DBUS_SHLIB_SONAME = $(SEM_DBUS_SHLIB_LINKERNAME).$(SEM_DBUS_SHLIB_MAJOR)
SEM_DBUS_SHLIB_REALNAME = $(SEM_DBUS_SHLIB_SONAME).$(SEM_DBUS_SHLIB_MINOR)


.PHONY: all
all: $(SEM_DBUS_SHLIB_REALNAME)
	echo $(BUILDROOTDIR)/usr/include/dbus-1.0

$(SEM_DBUS_SHLIB_REALNAME): $(SEM_DBUS_OBJS)
	@echo $(BUILDROOTDIR)/usr/include/dbus-1.0
	$(CC) ${LDFLAGS} $(LD_PATH) -o $@ $^ $(DBUS_LIBS)
	mv $(SEM_DBUS_SHLIB_REALNAME) $(LIB_EXPORT_DIR)/
	ln -sf $(SEM_DBUS_SHLIB_REALNAME) $(LIB_EXPORT_DIR)/$(SEM_DBUS_SHLIB_SONAME) 
	ln -sf $(SEM_DBUS_SHLIB_SONAME) $(LIB_EXPORT_DIR)/$(SEM_DBUS_SHLIB_LINKERNAME) 	


%.o: %.c
	${RM} $@
	$(CC) -c $(CCFLAGS) $(INCLUDES) -o $*.o $<	


.PHONY: clean
clean: 
	$(RM) *.o $(SEM_DBUS_SHLIB_LINKERNAME) $(SEM_DBUS_SHLIB_SONAME) $(SEM_DBUS_SHLIB_REALNAME)
	
