<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Octeon Common Component: cvm-common-defs.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>cvm-common-defs.h</h1><a href="cvm-common-defs_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/***********************************************************************</span>
00002 <span class="comment"></span>
00003 <span class="comment">  OCTEON TOOLKITS                                                         </span>
00004 <span class="comment">  Copyright (c) 2007 Cavium Networks. All rights reserved.</span>
00005 <span class="comment"></span>
00006 <span class="comment">  This file, which is part of the OCTEON TOOLKIT from Cavium Networks,</span>
00007 <span class="comment">  contains proprietary and confidential information of Cavium Networks</span>
00008 <span class="comment">  and in some cases its suppliers.</span>
00009 <span class="comment"></span>
00010 <span class="comment">  Any licensed reproduction, distribution, modification, or other use of</span>
00011 <span class="comment">  this file or confidential information embodied in this file is subject</span>
00012 <span class="comment">  to your license agreement with Cavium Networks. The applicable license</span>
00013 <span class="comment">  terms can be found by contacting Cavium Networks or the appropriate</span>
00014 <span class="comment">  representative within your company.</span>
00015 <span class="comment"></span>
00016 <span class="comment">  All other use and disclosure is prohibited.</span>
00017 <span class="comment"></span>
00018 <span class="comment">  Contact Cavium Networks at info@caviumnetworks.com for more information.</span>
00019 <span class="comment"></span>
00020 <span class="comment"> ************************************************************************/</span> 
00021 
00022 <span class="preprocessor">#ifndef __CVM_COMMON_DEFS_H__</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#define __CVM_COMMON_DEFS_H__</span>
00024 <span class="preprocessor"></span>
00025 <span class="preprocessor">#ifdef INET6</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#undef CVM_IP_DYNAMIC_SHORT_SUPPORT</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00028 <span class="preprocessor"></span>
00029 <span class="preprocessor">#ifdef CVM_IP_DYNAMIC_SHORT_SUPPORT</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_PD_ALIGN (4+16) </span><span class="comment">/* Hardware aligns IP header in packet_data */</span>
00031 <span class="preprocessor">#define CVM_COMMON_IP6_PD_ALIGN 16 </span><span class="comment">/* Hardware aligns IP header in packet_data */</span>
00032 <span class="preprocessor">#else</span>
<a name="l00033"></a><a class="code" href="cvm-common-defs_8h.html#a0">00033</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_PD_ALIGN 4 </span><span class="comment">/* Hardware aligns IP header in packet_data */</span>
<a name="l00034"></a><a class="code" href="cvm-common-defs_8h.html#a1">00034</a> <span class="preprocessor">#define CVM_COMMON_IP6_PD_ALIGN 0 </span><span class="comment">/* Hardware aligns IP header in packet_data */</span>
00035 <span class="preprocessor">#endif</span>
00036 <span class="preprocessor"></span>
<a name="l00037"></a><a class="code" href="cvm-common-defs_8h.html#a2">00037</a> <span class="preprocessor">#define CVM_COMMON_BIG_ENDIAN 4321</span>
<a name="l00038"></a><a class="code" href="cvm-common-defs_8h.html#a3">00038</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_LITTLE_ENDIAN 1234</span>
<a name="l00039"></a><a class="code" href="cvm-common-defs_8h.html#a4">00039</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_BYTE_ORDER CVM_COMMON_BIG_ENDIAN</span>
00040 <span class="preprocessor"></span>
<a name="l00041"></a><a class="code" href="cvm-common-defs_8h.html#a5">00041</a> <span class="preprocessor">#define CVM_COMMON_WQE_INVALID                      0xff</span>
<a name="l00042"></a><a class="code" href="cvm-common-defs_8h.html#a6">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_WQE_TIMER_INTERRUPT              1</span>
<a name="l00043"></a><a class="code" href="cvm-common-defs_8h.html#a7">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_WQE_LONG_TIMER_INTERRUPT         2</span>
<a name="l00044"></a><a class="code" href="cvm-common-defs_8h.html#a8">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_WQE_APP_TO_TCP                   3</span>
<a name="l00045"></a><a class="code" href="cvm-common-defs_8h.html#a9">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_WQE_APP_TO_UDP                   4</span>
<a name="l00046"></a><a class="code" href="cvm-common-defs_8h.html#a10">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_WQE_ENET_SLOW_TIMER_INTERRUPT    5</span>
<a name="l00047"></a><a class="code" href="cvm-common-defs_8h.html#a11">00047</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_WQE_APP_TO_RAW                   6</span>
<a name="l00048"></a><a class="code" href="cvm-common-defs_8h.html#a12">00048</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_WQE_ND6_TIMER_INTERRUPT          7</span>
<a name="l00049"></a><a class="code" href="cvm-common-defs_8h.html#a13">00049</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_WQE_ND6_SLOW_TIMER_INTERRUPT     8</span>
<a name="l00050"></a><a class="code" href="cvm-common-defs_8h.html#a14">00050</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_WQE_ND6_LLINFO_TIMER_INTERRUPT   9</span>
<a name="l00051"></a><a class="code" href="cvm-common-defs_8h.html#a15">00051</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_WQE_ND6_DAD_TIMER_INTERRUPT      10</span>
<a name="l00052"></a><a class="code" href="cvm-common-defs_8h.html#a16">00052</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_WQE_IPSEC_DECRYPT_DONE           11</span>
00053 <span class="preprocessor"></span>
00054 <span class="comment">/* Timer ID for IGMP fast 200ms timer */</span>
<a name="l00055"></a><a class="code" href="cvm-common-defs_8h.html#a17">00055</a> <span class="preprocessor">#define CVM_COMMON_WQE_IGMP_FAST_TIMER_INTERRUPT    12</span>
00056 <span class="preprocessor"></span>
00057 <span class="comment">/* Timer ID for IGMP slow 500ms timer */</span>
<a name="l00058"></a><a class="code" href="cvm-common-defs_8h.html#a18">00058</a> <span class="preprocessor">#define CVM_COMMON_WQE_IGMP_SLOW_TIMER_INTERRUPT    13</span>
00059 <span class="preprocessor"></span>
<a name="l00060"></a><a class="code" href="cvm-common-defs_8h.html#a19">00060</a> <span class="preprocessor">#define CVM_COMMON_MINUS_ONE_64 (0xffffffffffffffffULL)</span>
<a name="l00061"></a><a class="code" href="cvm-common-defs_8h.html#a20">00061</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_ALLOC_INIT   (0xBADDEED0BADDEEDDULL)</span>
00062 <span class="preprocessor"></span>
00063 <span class="comment">/* Common Arena Allocation Parameters */</span>
<a name="l00064"></a><a class="code" href="cvm-common-defs_8h.html#a21">00064</a> <span class="preprocessor">#define CVM_COMMON_ARENA_SIZE    (8 * 1024 * 1024)</span>
<a name="l00065"></a><a class="code" href="cvm-common-defs_8h.html#a22">00065</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_ARENA_COUNT   (4)</span>
00066 <span class="preprocessor"></span>
00067 
<a name="l00068"></a><a class="code" href="cvm-common-defs_8h.html#a23">00068</a> <span class="preprocessor">#define CVM_COMMON_TICK_LEN_US (2000)      </span><span class="comment">/* tick length in microsec */</span>
<a name="l00069"></a><a class="code" href="cvm-common-defs_8h.html#a24">00069</a> <span class="preprocessor">#define CVM_COMMON_WHEEL_LEN_TICKS (2500)  </span><span class="comment">/* wheel length in ticks */</span>
00070 
<a name="l00071"></a><a class="code" href="cvm-common-defs_8h.html#a25">00071</a> <span class="preprocessor">#define CVM_COMMON_IDLE_PROCESSING_INTERVAL  5  </span><span class="comment">/* secs */</span>
00072 
00073 <span class="preprocessor">#if defined(__KERNEL__) &amp;&amp; defined(linux)</span>
00074 <span class="preprocessor"></span><span class="preprocessor">#define cvm_common_panic(...) \</span>
00075 <span class="preprocessor">    { \</span>
00076 <span class="preprocessor">       printk("PANIC:" __VA_ARGS__); \</span>
00077 <span class="preprocessor">       panic("%s:%d\n", __FILE__, __LINE__); \</span>
00078 <span class="preprocessor">    }</span>
00079 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00080 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="cvm-common-defs_8h.html#a104">exit</a>(<span class="keywordtype">int</span>);
00081 
<a name="l00082"></a><a class="code" href="cvm-common-defs_8h.html#a26">00082</a> <span class="preprocessor">#define cvm_common_panic(...) \</span>
00083 <span class="preprocessor">    { \</span>
00084 <span class="preprocessor">       printf("PANIC:" __VA_ARGS__); \</span>
00085 <span class="preprocessor">       exit(-1); \</span>
00086 <span class="preprocessor">    }</span>
00087 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00088 <span class="preprocessor"></span>
<a name="l00089"></a><a class="code" href="cvm-common-defs_8h.html#a27">00089</a> <span class="preprocessor">#define CVM_COMMON_KASSERT(exp,msg) \</span>
00090 <span class="preprocessor">    { \</span>
00091 <span class="preprocessor">    if(!(exp)) cvm_common_panic msg; \</span>
00092 <span class="preprocessor">    }</span>
00093 <span class="preprocessor"></span>    
00094 
<a name="l00095"></a><a class="code" href="cvm-common-defs_8h.html#a28">00095</a> <span class="preprocessor">#define cvm_common_ntohs(a) (a)</span>
<a name="l00096"></a><a class="code" href="cvm-common-defs_8h.html#a29">00096</a> <span class="preprocessor"></span><span class="preprocessor">#define cvm_common_htons(a) (a)</span>
<a name="l00097"></a><a class="code" href="cvm-common-defs_8h.html#a30">00097</a> <span class="preprocessor"></span><span class="preprocessor">#define cvm_common_ntohl(a) (a)</span>
<a name="l00098"></a><a class="code" href="cvm-common-defs_8h.html#a31">00098</a> <span class="preprocessor"></span><span class="preprocessor">#define cvm_common_htonl(a) (a)</span>
00099 <span class="preprocessor"></span>
00100 <span class="comment">/* Macros for counting and rounding. */</span>
<a name="l00101"></a><a class="code" href="cvm-common-defs_8h.html#a32">00101</a> <span class="preprocessor">#define cvm_common_howmany(x, y)   (((x)+((y)-1))/(y))</span>
<a name="l00102"></a><a class="code" href="cvm-common-defs_8h.html#a33">00102</a> <span class="preprocessor"></span><span class="preprocessor">#define cvm_common_rounddown(x, y) (((x)/(y))*(y))</span>
<a name="l00103"></a><a class="code" href="cvm-common-defs_8h.html#a34">00103</a> <span class="preprocessor"></span><span class="preprocessor">#define cvm_common_roundup(x, y)   ((((x)+((y)-1))/(y))*(y))  </span><span class="comment">/* to any y */</span>
<a name="l00104"></a><a class="code" href="cvm-common-defs_8h.html#a35">00104</a> <span class="preprocessor">#define cvm_common_roundup2(x, y)  (((x)+((y)-1))&amp;(~((y)-1))) </span><span class="comment">/* if y is powers of two */</span>
<a name="l00105"></a><a class="code" href="cvm-common-defs_8h.html#a36">00105</a> <span class="preprocessor">#define cvm_common_powerof2(x)     ((((x)-1)&amp;(x))==0)</span>
00106 <span class="preprocessor"></span>
<a name="l00107"></a><a class="code" href="cvm-common-defs_8h.html#a37">00107</a> <span class="preprocessor">#define CVM_COMMON_MALLOC_BACK_VAL 0xF</span>
00108 <span class="preprocessor"></span>
<a name="l00109"></a><a class="code" href="cvm-common-defs_8h.html#a105">00109</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="cvm-common-defs_8h.html#a105">cvm_common_imax</a>(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b) { <span class="keywordflow">return</span> (a &gt; b ? a : b); }
<a name="l00110"></a><a class="code" href="cvm-common-defs_8h.html#a106">00110</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="cvm-common-defs_8h.html#a106">cvm_common_imin</a>(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b) { <span class="keywordflow">return</span> (a &lt; b ? a : b); }
00111 
<a name="l00112"></a><a class="code" href="cvm-common-defs_8h.html#a107">00112</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="cvm-common-defs_8h.html#a107">cvm_common_splnet</a>(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> 1; }
<a name="l00113"></a><a class="code" href="cvm-common-defs_8h.html#a108">00113</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="cvm-common-defs_8h.html#a108">cvm_common_splimp</a>(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> 1; }
<a name="l00114"></a><a class="code" href="cvm-common-defs_8h.html#a109">00114</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="cvm-common-defs_8h.html#a109">cvm_common_splx</a>(<span class="keywordtype">int</span> x) { <span class="keywordflow">return</span>; }
00115 
00116 
00117 <span class="comment">/* Groups for work queue entries */</span>
<a name="l00118"></a><a class="code" href="cvm-common-defs_8h.html#a118">00118</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> {
00119     <a class="code" href="cvm-common-defs_8h.html#a118a92">CVM_COMMON_PACKET_GRP</a>,
00120     <a class="code" href="cvm-common-defs_8h.html#a118a93">CVM_COMMON_HOST_MSG_GRP</a>
00121 } <a class="code" href="cvm-common-defs_8h.html#a118">cvm_common_work_grp</a>;
00122 
00123 <span class="comment">/* debug macros &amp; associated enums */</span>
00124 
00125 <span class="comment">/* local typedef for long long */</span>
00126 <span class="comment">/* used with SIMPRINTF macro   */</span>
<a name="l00127"></a><a class="code" href="cvm-common-defs_8h.html#a82">00127</a> <span class="keyword">typedef</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>    <a class="code" href="cvm-common-defs_8h.html#a82">ll64_t</a>;
00128 
00129 <span class="preprocessor">#ifdef REAL_HW</span>
00130 <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_PRINT_FN printf</span>
00131 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00132"></a><a class="code" href="cvm-common-defs_8h.html#a38">00132</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_PRINT_FN simprintf</span>
00133 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00134 <span class="preprocessor"></span>
00135 <span class="comment">/* macro to use either printf or simprintf   */</span>
00136 <span class="comment">/* depending on whether the code is running  */</span>
00137 <span class="comment">/* on simulator or real hardware             */</span>
00138 <span class="comment">/*                                           */</span>
00139 <span class="comment">/* this macro has following limitations:     */</span>
00140 <span class="comment">/*                                           */</span>
00141 <span class="comment">/* 1. cannot take more than 6 parameters     */</span>
00142 <span class="comment">/* 2. each parameter should be used with     */</span>
00143 <span class="comment">/*    %lld or %llX and should be typecast    */</span>
00144 <span class="comment">/*    with (long long). For example          */</span>
00145 <span class="comment">/*                                           */</span>
00146 <span class="comment">/*  int a = 0x45667544A;                     */</span>
00147 <span class="comment">/*  SIMPRINTF("a = 0x%llX\n", (long long)a); */</span>
00148 
00149 <span class="comment"></span>
00150 <span class="comment">/** Common Printf Wrapper macro</span>
00151 <span class="comment"> *  @param format    - standard printf format</span>
00152 <span class="comment"> *  @param args      - printf arguments</span>
00153 <span class="comment"> *</span>
00154 <span class="comment"> * While running on hardware, this macro is</span>
00155 <span class="comment"> * translated to normal printf. For the simulaotr</span>
00156 <span class="comment"> * the macro uses simprintf which is a faster</span>
00157 <span class="comment"> * variant of printf, but only applicable to</span>
00158 <span class="comment"> * the Octeon simulaotr.</span>
00159 <span class="comment"> *</span>
00160 <span class="comment"> */</span>
<a name="l00161"></a><a class="code" href="cvm-common-defs_8h.html#a39">00161</a> <span class="preprocessor">#define CVM_COMMON_SIMPRINTF(format, args...) \</span>
00162 <span class="preprocessor">{ \</span>
00163 <span class="preprocessor">    CVM_COMMON_PRINT_FN(format, ##args); \</span>
00164 <span class="preprocessor">}</span>
00165 <span class="preprocessor"></span>
00166 CVMX_SHARED <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="cvm-common-defs_8h.html#a83">cvm_common_debug_level</a>;
00167 
00168 <span class="comment">/* debug levels 1-9 */</span>
00169 <span class="comment">/* 1 : lowest level with minimum debugging information  */</span>
00170 <span class="comment">/* 9 : highest level with maximim debugging information */</span>
<a name="l00171"></a><a class="code" href="cvm-common-defs_8h.html#a119">00171</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> { 
00172         <a class="code" href="cvm-common-defs_8h.html#a119a94">CVM_COMMON_DBG_LVL_MUST_PRINT</a> = 1,
00173         <a class="code" href="cvm-common-defs_8h.html#a119a95">CVM_COMMON_DBG_LVL_CRITICAL</a> = 2,
00174         <a class="code" href="cvm-common-defs_8h.html#a119a96">CVM_COMMON_DBG_LVL_ERROR</a> = 3,
00175         <a class="code" href="cvm-common-defs_8h.html#a119a97">CVM_COMMON_DBG_LVL_WARNING</a> = 4,
00176         <a class="code" href="cvm-common-defs_8h.html#a119a98">CVM_COMMON_DBG_LVL_5</a> = 5,
00177         <a class="code" href="cvm-common-defs_8h.html#a119a99">CVM_COMMON_DBG_LVL_6</a> = 6,
00178         <a class="code" href="cvm-common-defs_8h.html#a119a100">CVM_COMMON_DBG_LVL_7</a> = 7,
00179         <a class="code" href="cvm-common-defs_8h.html#a119a101">CVM_COMMON_DBG_LVL_8</a> = 8,
00180         <a class="code" href="cvm-common-defs_8h.html#a119a102">CVM_COMMON_DBG_LVL_INFO</a> = 9,
00181         <a class="code" href="cvm-common-defs_8h.html#a119a103">CVM_COMMON_MAX_DBG_LVL</a> 
00182 } <a class="code" href="cvm-common-defs_8h.html#a119">cvm_common_debug_level_t</a>;
00183 
00184 
00185 <span class="preprocessor">#ifdef OCTEON_DEBUG_LEVEL</span>
00186 <span class="preprocessor"></span><span class="comment"></span>
00187 <span class="comment">/** Common Debug Message Print macro</span>
00188 <span class="comment"> *</span>
00189 <span class="comment"> *  @param lvl      - debug level for the message</span>
00190 <span class="comment"> *  @param format   - message print format</span>
00191 <span class="comment"> *  @param args     - print arguments</span>
00192 <span class="comment"> *</span>
00193 <span class="comment"> * This macro is used for debug message printng. The</span>
00194 <span class="comment"> * lvl parameter specifies the debug level for this </span>
00195 <span class="comment"> * message. The OCTEON_DEBUG_LEVEL specifies system</span>
00196 <span class="comment"> * wide debug level. The message is only printed if</span>
00197 <span class="comment"> * the lvl paramter is less than or equal to the</span>
00198 <span class="comment"> * OCTEON_DEBUG_LEVEL.</span>
00199 <span class="comment"> *</span>
00200 <span class="comment"> * Note that the debug message printing is enabled</span>
00201 <span class="comment"> * only when the OCTEON_DEBUG_LEVEL is defined and</span>
00202 <span class="comment"> * assigned a number from 0-9. If OCTEON_DEBUG_LEVEL</span>
00203 <span class="comment"> * is not defined, all the calls to this macro are</span>
00204 <span class="comment"> * ignored. </span>
00205 <span class="comment"> *</span>
00206 <span class="comment"> */</span>
<a name="l00207"></a><a class="code" href="cvm-common-defs_8h.html#a40">00207</a> <span class="preprocessor">#define CVM_COMMON_DBG_MSG(lvl, format, args...) \</span>
00208 <span class="preprocessor">{ \</span>
00209 <span class="preprocessor">    if ((lvl &lt;= cvm_common_debug_level) &amp;&amp; (lvl &lt; CVM_COMMON_MAX_DBG_LVL)) \</span>
00210 <span class="preprocessor">    { \</span>
00211 <span class="preprocessor">        printf("[DBG %d] ", lvl); \</span>
00212 <span class="preprocessor">        printf(format, ##args); \</span>
00213 <span class="preprocessor">    } \</span>
00214 <span class="preprocessor">}</span>
00215 <span class="preprocessor"></span>
00216 <span class="comment"></span>
00217 <span class="comment">/** Common Debug Memory Dump macro</span>
00218 <span class="comment"> *</span>
00219 <span class="comment"> *  @param lvl      - debug level</span>
00220 <span class="comment"> *  @param buf      - char pointer to the buffer</span>
00221 <span class="comment"> *  @param len      - number of bytes to dump</span>
00222 <span class="comment"> *</span>
00223 <span class="comment"> * This macro is used to dump memory. The</span>
00224 <span class="comment"> * lvl parameter specifies the debug level for this </span>
00225 <span class="comment"> * dump. The OCTEON_DEBUG_LEVEL specifies system</span>
00226 <span class="comment"> * wide debug level. The message is only printed if</span>
00227 <span class="comment"> * the lvl paramter is less than or equal to the</span>
00228 <span class="comment"> * OCTEON_DEBUG_LEVEL.</span>
00229 <span class="comment"> *</span>
00230 <span class="comment"> * Note that the debug memory dump macro is enabled</span>
00231 <span class="comment"> * only when the OCTEON_DEBUG_LEVEL is defined and</span>
00232 <span class="comment"> * assigned a number from 0-9. If OCTEON_DEBUG_LEVEL</span>
00233 <span class="comment"> * is not defined, all the calls to this macro are</span>
00234 <span class="comment"> * ignored. </span>
00235 <span class="comment"> *</span>
00236 <span class="comment"> */</span>
<a name="l00237"></a><a class="code" href="cvm-common-defs_8h.html#a41">00237</a> <span class="preprocessor">#define CVM_COMMON_DBG_DUMP(lvl, buf, len) \</span>
00238 <span class="preprocessor">{ \</span>
00239 <span class="preprocessor">    if ((lvl &lt;= cvm_common_debug_level) &amp;&amp; (lvl &lt; CVM_COMMON_MAX_DBG_LVL)) \</span>
00240 <span class="preprocessor">    { \</span>
00241 <span class="preprocessor">        int a=0; \</span>
00242 <span class="preprocessor">        unsigned char tmp=0; \</span>
00243 <span class="preprocessor">        printf("[DBG %d]\n", lvl); \</span>
00244 <span class="preprocessor">        printf("0x%04X : ", a); \</span>
00245 <span class="preprocessor">        for (a=0;a&lt;(len);a++) \</span>
00246 <span class="preprocessor">        { \</span>
00247 <span class="preprocessor">        if(a &amp;&amp; ((a%8) == 0)) \</span>
00248 <span class="preprocessor">            { \</span>
00249 <span class="preprocessor">        printf("%s", "\n"); \</span>
00250 <span class="preprocessor">                printf("0x%04X : ", a); \</span>
00251 <span class="preprocessor">            } \</span>
00252 <span class="preprocessor">        tmp = (buf)[a];\</span>
00253 <span class="preprocessor">        tmp &amp;= 0xff;\</span>
00254 <span class="preprocessor">        printf("%02x ",tmp);\</span>
00255 <span class="preprocessor">        } \</span>
00256 <span class="preprocessor">    printf("\n\n"); \</span>
00257 <span class="preprocessor">    } \</span>
00258 <span class="preprocessor">}</span>
00259 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00260 <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_DBG_MSG(lvl,format, args...);</span>
00261 <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_DBG_DUMP(lvl, buf, len);</span>
00262 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00263 <span class="preprocessor"></span>
00264 
00265 <span class="preprocessor">#if defined(__KERNEL__) &amp;&amp; defined(linux)</span>
00266 <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_MALLOC_TSAFE(arena_list,size) \</span>
00267 <span class="preprocessor">({ \</span>
00268 <span class="preprocessor">    void *ptr= NULL; \</span>
00269 <span class="preprocessor">    ptr = kmalloc(size, GFP_DMA); \</span>
00270 <span class="preprocessor">    ptr; \</span>
00271 <span class="preprocessor">})</span>
00272 <span class="preprocessor"></span>  
00273   
00274 <span class="preprocessor">#define CVM_COMMON_FREE_TSAFE(ptr) \</span>
00275 <span class="preprocessor">{ \</span>
00276 <span class="preprocessor">    kfree(ptr); \</span>
00277 <span class="preprocessor">}</span>
00278 <span class="preprocessor"></span>
00279 <span class="preprocessor">#elif defined(linux)</span>
00280 <span class="preprocessor"></span>
00281 <span class="preprocessor">#define CVM_COMMON_MALLOC_TSAFE(arena_list,size) \</span>
00282 <span class="preprocessor">({ \</span>
00283 <span class="preprocessor">    void *ptr= NULL; \</span>
00284 <span class="preprocessor">    ptr = malloc(size); \</span>
00285 <span class="preprocessor">    ptr; \</span>
00286 <span class="preprocessor">})</span>
00287 <span class="preprocessor"></span>  
00288 <span class="preprocessor">#define CVM_COMMON_FREE_TSAFE(ptr) \</span>
00289 <span class="preprocessor">{ \</span>
00290 <span class="preprocessor">    free(ptr); \</span>
00291 <span class="preprocessor">}</span>
00292 <span class="preprocessor"></span>
00293 <span class="preprocessor">#else</span>
00294 <span class="preprocessor"></span><span class="comment">/*</span>
00295 <span class="comment"> * threadsafe functionality of cvmx_malloc</span>
00296 <span class="comment"> */</span>
00297 <span class="keyword">extern</span> CVMX_SHARED cvmx_spinlock_t <a class="code" href="cvm-common-defs_8h.html#a84">cvm_common_malloc_lock</a>;
00298 
<a name="l00299"></a><a class="code" href="cvm-common-defs_8h.html#a42">00299</a> <span class="preprocessor">#define CVM_COMMON_MALLOC_TSAFE(arena_list, size) \</span>
00300 <span class="preprocessor">({ \</span>
00301 <span class="preprocessor">    void *ptr = NULL; \</span>
00302 <span class="preprocessor">    cvmx_spinlock_lock(&amp;cvm_common_malloc_lock); \</span>
00303 <span class="preprocessor">    ptr = cvmx_malloc(arena_list, size); \</span>
00304 <span class="preprocessor">    cvmx_spinlock_unlock(&amp;cvm_common_malloc_lock); \</span>
00305 <span class="preprocessor">    ptr; \</span>
00306 <span class="preprocessor">})</span>
00307 <span class="preprocessor"></span>
<a name="l00308"></a><a class="code" href="cvm-common-defs_8h.html#a43">00308</a> <span class="preprocessor">#define CVM_COMMON_FREE_TSAFE(ptr) \</span>
00309 <span class="preprocessor">{ \</span>
00310 <span class="preprocessor">    cvmx_spinlock_lock(&amp;cvm_common_malloc_lock); \</span>
00311 <span class="preprocessor">    cvmx_free(ptr); \</span>
00312 <span class="preprocessor">    cvmx_spinlock_unlock(&amp;cvm_common_malloc_lock); \</span>
00313 <span class="preprocessor">}</span>
00314 <span class="preprocessor"></span>
<a name="l00315"></a><a class="code" href="cvm-common-defs_8h.html#a44">00315</a> <span class="preprocessor">#define CVM_COMMON_REALLOC_TSAFE(arena_list, oldptr, size)  \</span>
00316 <span class="preprocessor">({ \</span>
00317 <span class="preprocessor">    void *ptr = NULL; \</span>
00318 <span class="preprocessor">    cvmx_spinlock_lock(&amp;cvm_common_malloc_lock); \</span>
00319 <span class="preprocessor">    ptr = cvmx_realloc(arena_list, oldptr, size);   \</span>
00320 <span class="preprocessor">    cvmx_spinlock_unlock(&amp;cvm_common_malloc_lock); \</span>
00321 <span class="preprocessor">    ptr; \</span>
00322 <span class="preprocessor">})</span>
00323 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00324 <span class="preprocessor"></span>
00325 
00326 <span class="preprocessor">#ifdef OUT_SWP_IN_SCRATCH // {</span>
00327 <span class="preprocessor"></span><span class="preprocessor">#define out_swp (*((cvm_common_wqe_t **)(CVMX_SCRATCH_BASE + CVMX_SCR_OUT_SWP)))</span>
00328 <span class="preprocessor"></span><span class="preprocessor">#define out_swp_tail (*((cvm_common_wqe_t **)(CVMX_SCRATCH_BASE + CVMX_SCR_OUT_SWP_TAIL)))</span>
00329 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00330 <span class="preprocessor"></span><span class="preprocessor">#ifdef __KERNEL__</span>
00331 <span class="preprocessor"></span>DECLARE_PER_CPU(<a class="code" href="structcvm__common__wqe.html">cvm_common_wqe_t</a> *, __out_swp);
00332 DECLARE_PER_CPU(<a class="code" href="structcvm__common__wqe.html">cvm_common_wqe_t</a> * , __out_swp_tail);
00333 <span class="preprocessor">#define out_swp __get_cpu_var(__out_swp)</span>
00334 <span class="preprocessor"></span><span class="preprocessor">#define out_swp_tail __get_cpu_var(__out_swp_tail)</span>
00335 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00336 <span class="preprocessor"></span><span class="keyword">extern</span> <a class="code" href="structcvm__common__wqe.html">cvm_common_wqe_t</a> *<a class="code" href="cvm-common-defs_8h.html#a85">out_swp</a>;
00337 <span class="keyword">extern</span> <a class="code" href="structcvm__common__wqe.html">cvm_common_wqe_t</a> *<a class="code" href="cvm-common-defs_8h.html#a86">out_swp_tail</a>;
00338 <span class="preprocessor">#endif</span>
00339 <span class="preprocessor"></span><span class="preprocessor">#endif // OUT_SWP_IN_SCRATCH }</span>
00340 <span class="preprocessor"></span>
00341 
00342 <span class="comment">/* common function declarations */</span>
00343 <span class="keywordtype">int</span> <a class="code" href="cvm-common-defs_8h.html#a110">cvm_common_allocate_arenas</a>(uint64_t arena_size, uint64_t arena_count);
00344 <span class="keywordtype">int</span> <a class="code" href="cvm-common-defs_8h.html#a111">cvm_common_global_init</a>(<span class="keywordtype">void</span>);
00345 <span class="keywordtype">int</span> <a class="code" href="cvm-common-defs_8h.html#a112">cvm_common_local_init</a>(<span class="keywordtype">void</span>);
00346 <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="cvm-common-defs_8h.html#a113">cvm_common_get_version</a>(<span class="keywordtype">void</span>);
00347 <span class="keywordtype">int</span> <a class="code" href="cvm-common-defs_8h.html#a114">cvm_common_do_idle_processing</a>(<span class="keywordtype">void</span>);
00348 
00349 
00350 
00351 <span class="comment">/* packet dump related misc routines */</span>
00352 <span class="keywordtype">void</span> <a class="code" href="cvm-common-defs_8h.html#a115">cvm_common_dump_special</a>(cvmx_wqe_t *work);
00353 <span class="keywordtype">void</span> <a class="code" href="cvm-common-defs_8h.html#a116">cvm_common_dump_packet</a>(cvmx_wqe_t *work, <span class="keywordtype">int</span> dir);
00354 <span class="keywordtype">void</span> <a class="code" href="cvm-common-defs_8h.html#a117">cvm_common_dump_packet_gth</a>(<a class="code" href="structcvm__common__wqe.html">cvm_common_wqe_t</a> *work);
00355 
00356 <span class="preprocessor">#if !defined(__KERNEL__) &amp;&amp; !defined(linux)</span>
00357 <span class="preprocessor"></span><span class="comment">/* common externs */</span>
00358 <span class="keyword">extern</span> CVMX_SHARED cvmx_arena_list_t  <a class="code" href="cvm-common-defs_8h.html#a87">cvm_common_arenas</a>;
00359 <span class="preprocessor">#endif</span>
00360 <span class="preprocessor"></span>
00361 <span class="preprocessor">#if defined(__KERNEL__) &amp;&amp; defined(linux)</span>
00362 <span class="preprocessor"></span><span class="preprocessor">#define bcopy(s,d,n) memcpy(d,s,n)</span>
00363 <span class="preprocessor"></span><span class="preprocessor">#define bzero(s,n) memset(s,0,n)</span>
00364 <span class="preprocessor"></span><span class="preprocessor">#define bcmp(s1,s2,n) memcmp(s1,s2,n)</span>
00365 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> uint64_t ulmin(uint64_t a, uint64_t b)
00366 {
00367  <span class="keywordflow">return</span> (((a)&lt;(b))?(a):(b));
00368 }
00369 <span class="preprocessor">#endif</span>
00370 <span class="preprocessor"></span>
<a name="l00371"></a><a class="code" href="cvm-common-defs_8h.html#a45">00371</a> <span class="preprocessor">#define cvm_common_bootmem_alloc(size, flags) cvmx_bootmem_alloc(size,flags)</span>
00372 <span class="preprocessor"></span>
00373 <span class="comment">/*</span>
00374 <span class="comment"> * Various network packet headers</span>
00375 <span class="comment"> */</span>
00376 
00377 <span class="comment">/*</span>
00378 <span class="comment"> * Structure of IP header (IPV4)</span>
00379 <span class="comment"> */</span>
<a name="l00380"></a><a class="code" href="structcvm__common__ip__hdr.html">00380</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structcvm__common__ip__hdr.html">cvm_common_ip_hdr</a> 
00381 {
00382 
<a name="l00383"></a><a class="code" href="structcvm__common__ip__hdr.html#o0">00383</a>     uint32_t <a class="code" href="structcvm__common__ip__hdr.html#o0">ip_v</a>:4;        <span class="comment">/* version */</span>
<a name="l00384"></a><a class="code" href="structcvm__common__ip__hdr.html#o1">00384</a>     uint32_t <a class="code" href="structcvm__common__ip__hdr.html#o1">ip_hl</a>:4;       <span class="comment">/* header length */</span>
<a name="l00385"></a><a class="code" href="structcvm__common__ip__hdr.html#o2">00385</a>     uint32_t <a class="code" href="structcvm__common__ip__hdr.html#o2">ip_tos</a>:8;      <span class="comment">/* type of service */</span>
<a name="l00386"></a><a class="code" href="structcvm__common__ip__hdr.html#o3">00386</a>     uint32_t <a class="code" href="structcvm__common__ip__hdr.html#o3">ip_len</a>:16;     <span class="comment">/* total length */</span>
<a name="l00387"></a><a class="code" href="structcvm__common__ip__hdr.html#o4">00387</a>     uint32_t <a class="code" href="structcvm__common__ip__hdr.html#o4">ip_id</a>:16;      <span class="comment">/* identification */</span>
<a name="l00388"></a><a class="code" href="structcvm__common__ip__hdr.html#o5">00388</a>     uint32_t <a class="code" href="structcvm__common__ip__hdr.html#o5">ip_off</a>:16;     <span class="comment">/* fragment offset field */</span>
<a name="l00389"></a><a class="code" href="structcvm__common__ip__hdr.html#o6">00389</a>     uint32_t <a class="code" href="structcvm__common__ip__hdr.html#o6">ip_ttl</a>:8;      <span class="comment">/* time to live */</span>
<a name="l00390"></a><a class="code" href="structcvm__common__ip__hdr.html#o7">00390</a>     uint32_t <a class="code" href="structcvm__common__ip__hdr.html#o7">ip_p</a>:8;        <span class="comment">/* protocol */</span>
<a name="l00391"></a><a class="code" href="structcvm__common__ip__hdr.html#o8">00391</a>     uint32_t <a class="code" href="structcvm__common__ip__hdr.html#o8">ip_sum</a>:16;     <span class="comment">/* checksum */</span>
<a name="l00392"></a><a class="code" href="structcvm__common__ip__hdr.html#o9">00392</a>     uint32_t <a class="code" href="structcvm__common__ip__hdr.html#o9">ip_src</a>;            <span class="comment">/* source address */</span>
<a name="l00393"></a><a class="code" href="structcvm__common__ip__hdr.html#o10">00393</a>     uint32_t <a class="code" href="structcvm__common__ip__hdr.html#o10">ip_dst</a>;            <span class="comment">/* dest address */</span>
00394 
00395 } <a class="code" href="structcvm__common__ip__hdr.html">cvm_common_ip_hdr_t</a>;
00396 
00397 
00398 <span class="comment">/*</span>
00399 <span class="comment"> * Structure of TCP header.</span>
00400 <span class="comment"> */</span>
<a name="l00401"></a><a class="code" href="structcvm__common__tcp__hdr.html">00401</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structcvm__common__tcp__hdr.html">cvm_common_tcp_hdr</a> 
00402 {
<a name="l00403"></a><a class="code" href="structcvm__common__tcp__hdr.html#o0">00403</a>     uint16_t  <a class="code" href="structcvm__common__tcp__hdr.html#o0">th_sport</a>;     <span class="comment">/* source port */</span>
<a name="l00404"></a><a class="code" href="structcvm__common__tcp__hdr.html#o1">00404</a>     uint16_t  <a class="code" href="structcvm__common__tcp__hdr.html#o1">th_dport</a>;     <span class="comment">/* destination port */</span>
<a name="l00405"></a><a class="code" href="structcvm__common__tcp__hdr.html#o2">00405</a>     uint32_t  <a class="code" href="structcvm__common__tcp__hdr.html#o2">th_seq</a>;       <span class="comment">/* sequence number */</span>
<a name="l00406"></a><a class="code" href="structcvm__common__tcp__hdr.html#o3">00406</a>     uint32_t  <a class="code" href="structcvm__common__tcp__hdr.html#o3">th_ack</a>;       <span class="comment">/* acknowledgement number */</span>
<a name="l00407"></a><a class="code" href="structcvm__common__tcp__hdr.html#o5">00407</a>     uint32_t  <a class="code" href="structcvm__common__tcp__hdr.html#o4">th_off</a>:4,     <span class="comment">/* data offset */</span>
00408               <a class="code" href="structcvm__common__tcp__hdr.html#o5">th_x2</a>:4;      <span class="comment">/* (unused) */</span>
<a name="l00409"></a><a class="code" href="structcvm__common__tcp__hdr.html#o6">00409</a>     uint8_t   <a class="code" href="structcvm__common__tcp__hdr.html#o6">th_flags</a>;
<a name="l00410"></a><a class="code" href="structcvm__common__tcp__hdr.html#o7">00410</a>     uint16_t  <a class="code" href="structcvm__common__tcp__hdr.html#o7">th_win</a>;           <span class="comment">/* window */</span>
<a name="l00411"></a><a class="code" href="structcvm__common__tcp__hdr.html#o8">00411</a>     uint16_t  <a class="code" href="structcvm__common__tcp__hdr.html#o8">th_sum</a>;           <span class="comment">/* checksum */</span>
<a name="l00412"></a><a class="code" href="structcvm__common__tcp__hdr.html#o9">00412</a>     uint16_t  <a class="code" href="structcvm__common__tcp__hdr.html#o9">th_urp</a>;       <span class="comment">/* urgent pointer */</span>
00413 
00414 } <a class="code" href="structcvm__common__tcp__hdr.html">cvm_common_tcp_hdr_t</a>;
00415 
00416 
00417 <span class="comment">/* various TCP flags */</span>
<a name="l00418"></a><a class="code" href="cvm-common-defs_8h.html#a46">00418</a> <span class="preprocessor">#define CVM_COMMON_TCP_TH_FIN    0x01</span>
<a name="l00419"></a><a class="code" href="cvm-common-defs_8h.html#a47">00419</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_TCP_TH_SYN    0x02</span>
<a name="l00420"></a><a class="code" href="cvm-common-defs_8h.html#a48">00420</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_TCP_TH_RST    0x04</span>
<a name="l00421"></a><a class="code" href="cvm-common-defs_8h.html#a49">00421</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_TCP_TH_PUSH   0x08</span>
<a name="l00422"></a><a class="code" href="cvm-common-defs_8h.html#a50">00422</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_TCP_TH_ACK    0x10</span>
<a name="l00423"></a><a class="code" href="cvm-common-defs_8h.html#a51">00423</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_TCP_TH_URG    0x20</span>
<a name="l00424"></a><a class="code" href="cvm-common-defs_8h.html#a52">00424</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_TCP_TH_ECE    0x40</span>
<a name="l00425"></a><a class="code" href="cvm-common-defs_8h.html#a53">00425</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_TCP_TH_CWR    0x80</span>
00426 <span class="preprocessor"></span>
00427 <span class="comment">/* various protocols */</span>
<a name="l00428"></a><a class="code" href="cvm-common-defs_8h.html#a54">00428</a> <span class="preprocessor">#define CVM_COMMON_IPPROTO_IP       0</span>
<a name="l00429"></a><a class="code" href="cvm-common-defs_8h.html#a55">00429</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_IPPROTO_ICMP     1</span>
<a name="l00430"></a><a class="code" href="cvm-common-defs_8h.html#a56">00430</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_IPPROTO_TCP      6</span>
<a name="l00431"></a><a class="code" href="cvm-common-defs_8h.html#a57">00431</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_IPPROTO_UDP     17</span>
<a name="l00432"></a><a class="code" href="cvm-common-defs_8h.html#a58">00432</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_IPPROTO_RAW    255</span>
00433 <span class="preprocessor"></span>
00434 <span class="comment"></span>
00435 <span class="comment">/** zero copy 64 bit buffer pointer (BP) related macros </span>
00436 <span class="comment"> *                                                     </span>
00437 <span class="comment"> * A note about these macros:                         </span>
00438 <span class="comment"> *                                                   </span>
00439 <span class="comment"> * The input 'p' to all SET_BP* macros could either be</span>
00440 <span class="comment"> * a uint64_t value or a pointer. e.g.               </span>
00441 <span class="comment"> *                                                  </span>
00442 <span class="comment"> *    uint64_t addr = 0;                           </span>
00443 <span class="comment"> *    void *ptr = 0;                              </span>
00444 <span class="comment"> *                                               </span>
00445 <span class="comment"> *    SET_BP_BACK(addr, 0xd);                   </span>
00446 <span class="comment"> *    SET_BP_BACK(ptr,  0x3);                  </span>
00447 <span class="comment"> *                                            </span>
00448 <span class="comment"> * but you shouldn't do a typecast a pointer to a</span>
00449 <span class="comment"> * uint64_t within the parameters of the macro i.e.</span>
00450 <span class="comment"> *                                                </span>
00451 <span class="comment"> *   SET_BP_BACK( (uint64_t)ptr, 0x3);           </span>
00452 <span class="comment"> *                                              </span>
00453 <span class="comment"> * this will confuse the compiler as it will not be    </span>
00454 <span class="comment"> * able to get the address of the ptr                 </span>
00455 <span class="comment"> *                                                   </span>
00456 <span class="comment"> * This restriction does not apply to GET_BP* macros</span>
00457 <span class="comment"> */</span>
00458 
<a name="l00459"></a><a class="code" href="cvm-common-defs_8h.html#a59">00459</a> <span class="preprocessor">#define CVM_COMMON_GET_BP_I_BIT(p) ( ((cvmx_buf_ptr_t)((uint64_t)(p))).s.i )</span>
<a name="l00460"></a><a class="code" href="cvm-common-defs_8h.html#a60">00460</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_GET_BP_BACK(p)  ( ((cvmx_buf_ptr_t)((uint64_t)(p))).s.back )</span>
<a name="l00461"></a><a class="code" href="cvm-common-defs_8h.html#a61">00461</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_GET_BP_POOL(p)  ( ((cvmx_buf_ptr_t)((uint64_t)(p))).s.pool )</span>
<a name="l00462"></a><a class="code" href="cvm-common-defs_8h.html#a62">00462</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_GET_BP_SIZE(p)  ( ((cvmx_buf_ptr_t)((uint64_t)(p))).s.size )</span>
<a name="l00463"></a><a class="code" href="cvm-common-defs_8h.html#a63">00463</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_GET_BP_ADDR(p)  ( ((cvmx_buf_ptr_t)((uint64_t)(p))).s.addr )</span>
00464 <span class="preprocessor"></span>
<a name="l00465"></a><a class="code" href="cvm-common-defs_8h.html#a64">00465</a> <span class="preprocessor">#define CVM_COMMON_SET_BP_I_BIT(p,v) ( (((cvmx_buf_ptr_t*)(&amp;(p))))-&gt;s.i=v )</span>
<a name="l00466"></a><a class="code" href="cvm-common-defs_8h.html#a65">00466</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_SET_BP_BACK(p,v)  ( (((cvmx_buf_ptr_t*)(&amp;(p))))-&gt;s.back=v )</span>
<a name="l00467"></a><a class="code" href="cvm-common-defs_8h.html#a66">00467</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_SET_BP_POOL(p,v)  ( (((cvmx_buf_ptr_t*)(&amp;(p))))-&gt;s.pool=v )</span>
<a name="l00468"></a><a class="code" href="cvm-common-defs_8h.html#a67">00468</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_SET_BP_SIZE(p,v)  ( (((cvmx_buf_ptr_t*)(&amp;(p))))-&gt;s.size=v  )</span>
<a name="l00469"></a><a class="code" href="cvm-common-defs_8h.html#a68">00469</a> <span class="preprocessor"></span><span class="preprocessor">#define CVM_COMMON_SET_BP_ADDR(p,v)  ( (((cvmx_buf_ptr_t*)(&amp;(p))))-&gt;s.addr=v )</span>
00470 <span class="preprocessor"></span>
00471 
<a name="l00472"></a><a class="code" href="cvm-common-defs_8h.html#a69">00472</a> <span class="preprocessor">#define CVM_COMMON_SET_BP(bp, addr, size, pool, back, i) \</span>
00473 <span class="preprocessor">{ \</span>
00474 <span class="preprocessor">    CVM_COMMON_SET_BP_ADDR(bp, addr); \</span>
00475 <span class="preprocessor">    CVM_COMMON_SET_BP_SIZE(bp, size); \</span>
00476 <span class="preprocessor">    CVM_COMMON_SET_BP_POOL(bp, pool); \</span>
00477 <span class="preprocessor">    CVM_COMMON_SET_BP_BACK(bp, back); \</span>
00478 <span class="preprocessor">    CVM_COMMON_SET_BP_I_BIT(bp, i);  \</span>
00479 <span class="preprocessor">}</span>
00480 <span class="preprocessor"></span>
<a name="l00481"></a><a class="code" href="cvm-common-defs_8h.html#a70">00481</a> <span class="preprocessor">#define CVM_COMMON_MARK_BP_AS_SW_BUFFER(bp) \</span>
00482 <span class="preprocessor">{ \</span>
00483 <span class="preprocessor">    CVM_COMMON_SET_BP_POOL((bp), CVMX_FPA_WQE_POOL); \</span>
00484 <span class="preprocessor">    CVM_COMMON_SET_BP_BACK((bp), CVM_COMMON_MALLOC_BACK_VAL); \</span>
00485 <span class="preprocessor">}</span>
00486 <span class="preprocessor"></span>
00487 
<a name="l00488"></a><a class="code" href="cvm-common-defs_8h.html#a71">00488</a> <span class="preprocessor">#define CVM_COMMON_IS_BP_SW_BUFFER(bp) ( ( ((CVM_COMMON_GET_BP_POOL(bp)) == CVMX_FPA_WQE_POOL) &amp;&amp; ( (CVM_COMMON_GET_BP_BACK(bp)) == CVM_COMMON_MALLOC_BACK_VAL)) ? 1 : 0 )</span>
00489 <span class="preprocessor"></span>
00490 
00491 
00492 <span class="comment">/*</span>
00493 <span class="comment"> * Various ptr types</span>
00494 <span class="comment"> */</span>
00495 
<a name="l00496"></a><a class="code" href="cvm-common-defs_8h.html#a72">00496</a> <span class="preprocessor">#define CVM_COMMON_DIRECT_DATA  0     </span><span class="comment">/**&lt; Local Pointer points directly to data */</span>
<a name="l00497"></a><a class="code" href="cvm-common-defs_8h.html#a73">00497</a> <span class="preprocessor">#define CVM_COMMON_GATHER_DATA  1     </span><span class="comment">/**&lt; Local Pointer points to a gather list of local pointers */</span>
<a name="l00498"></a><a class="code" href="cvm-common-defs_8h.html#a74">00498</a> <span class="preprocessor">#define CVM_COMMON_LINKED_DATA  2     </span><span class="comment">/**&lt; Local pointer points to data which has links to more buffers */</span>
<a name="l00499"></a><a class="code" href="cvm-common-defs_8h.html#a75">00499</a> <span class="preprocessor">#define CVM_COMMON_NULL_DATA    3     </span><span class="comment">/**&lt; If no data is sent and a flag is required, use this. */</span>
00500 
<a name="l00501"></a><a class="code" href="structcvm__common__pci__sanity__hdr.html">00501</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structcvm__common__pci__sanity__hdr.html">cvm_common_pci_sanity_hdr</a>
00502 {
<a name="l00503"></a><a class="code" href="structcvm__common__pci__sanity__hdr.html#o0">00503</a>     cvmx_buf_ptr_t      <a class="code" href="structcvm__common__pci__sanity__hdr.html#o0">lptr</a>;
<a name="l00504"></a><a class="code" href="structcvm__common__pci__sanity__hdr.html#o1">00504</a>     uint32_t            <a class="code" href="structcvm__common__pci__sanity__hdr.html#o1">pko_ptr_type</a>;
<a name="l00505"></a><a class="code" href="structcvm__common__pci__sanity__hdr.html#o2">00505</a>     uint32_t            <a class="code" href="structcvm__common__pci__sanity__hdr.html#o2">segs</a>;
<a name="l00506"></a><a class="code" href="structcvm__common__pci__sanity__hdr.html#o3">00506</a>     uint32_t            <a class="code" href="structcvm__common__pci__sanity__hdr.html#o3">total_bytes</a>;
<a name="l00507"></a><a class="code" href="structcvm__common__pci__sanity__hdr.html#o4">00507</a>     uint32_t            <a class="code" href="structcvm__common__pci__sanity__hdr.html#o4">port</a>;
00508 
00509 } <a class="code" href="structcvm__common__pci__sanity__hdr.html">cvm_common_pci_sanity_hdr_t</a>;
00510 
00511 
00512 <span class="comment">/*</span>
00513 <span class="comment"> * CAST macro</span>
00514 <span class="comment"> */</span>
<a name="l00515"></a><a class="code" href="cvm-common-defs_8h.html#a76">00515</a> <span class="preprocessor">#define CVM_COMMON_UCAST64(v) ((long long)(unsigned long)(v))</span>
00516 <span class="preprocessor"></span>
00517 
00518 <span class="comment">/*</span>
00519 <span class="comment"> * macro to calculate the back field (should only be used when</span>
00520 <span class="comment"> * FPA buffer size is power of 2)</span>
00521 <span class="comment"> */</span>
<a name="l00522"></a><a class="code" href="cvm-common-defs_8h.html#a77">00522</a> <span class="preprocessor">#define CVM_COMMON_CALC_BACK_POWER_2(p) ( (((p.s.addr - (p.s.addr &amp; ~((cvmx_fpa_get_block_size(p.s.pool))-1))) &gt;&gt; 7) &amp; 0xf) )</span>
00523 <span class="preprocessor"></span>
00524 
00525 <span class="comment">/*</span>
00526 <span class="comment"> * macro to calculate the back field correctly using</span>
00527 <span class="comment"> * the current address of an FPA buffer</span>
00528 <span class="comment"> */</span>
<a name="l00529"></a><a class="code" href="cvm-common-defs_8h.html#a78">00529</a> <span class="preprocessor">#define CVM_COMMON_CALC_BACK(p, offset)                                                                               \</span>
00530 <span class="preprocessor">({                                                                                                                     \</span>
00531 <span class="preprocessor">    int back = 0;                                                                                                      \</span>
00532 <span class="preprocessor">    uint64_t buf_start = ( ((p.s.addr - offset) &amp; ~(CVMX_CACHE_LINE_SIZE-1)) - (p.s.back*CVMX_CACHE_LINE_SIZE) );      \</span>
00533 <span class="preprocessor">    if (p.s.addr &lt;= buf_start)  back = 0;                                                                              \</span>
00534 <span class="preprocessor">    else                        back = (p.s.addr - buf_start) &gt;&gt; 7;                                                    \</span>
00535 <span class="preprocessor">    back;                                                                                                              \</span>
00536 <span class="preprocessor">})      </span>
00537 <span class="preprocessor"></span>
00538 
00539 <span class="comment">/*</span>
00540 <span class="comment"> * macro to calculate how much space is left in the buffer</span>
00541 <span class="comment"> * Assumptions:</span>
00542 <span class="comment"> *</span>
00543 <span class="comment"> * p.s.pool = pool of the buffer</span>
00544 <span class="comment"> * p.s.size = size of the existing data</span>
00545 <span class="comment"> * p.s.addr = pointer to the start of the current data</span>
00546 <span class="comment"> * p.s.back = back pointer value</span>
00547 <span class="comment"> *</span>
00548 <span class="comment"> */</span>
<a name="l00549"></a><a class="code" href="cvm-common-defs_8h.html#a79">00549</a> <span class="preprocessor">#define CVM_COMMON_SPACE_LEFT(p)  \</span>
00550 <span class="preprocessor">({ \</span>
00551 <span class="preprocessor">  unsigned int space = 0; \</span>
00552 <span class="preprocessor">  uint64_t buf_start = ( (p.s.addr &amp; ~(CVMX_CACHE_LINE_SIZE-1)) - (p.s.back*CVMX_CACHE_LINE_SIZE) ); \</span>
00553 <span class="preprocessor">  space = cvmx_fpa_get_block_size(p.s.pool) - ( (p.s.addr+p.s.size) - buf_start); \</span>
00554 <span class="preprocessor">  space; \</span>
00555 <span class="preprocessor">})</span>
00556 <span class="preprocessor"></span>
00557 
00558 <span class="comment">/*</span>
00559 <span class="comment"> * Pointer &lt;-&gt; Pointer_Offset conversion macros</span>
00560 <span class="comment"> */</span>
<a name="l00561"></a><a class="code" href="cvm-common-defs_8h.html#a80">00561</a> <span class="preprocessor">#define CVM_OFFSET_TO_PTR(ptr_offset, ptr_type, bit_shift) \</span>
00562 <span class="preprocessor">        (CASTPTR(ptr_type, cvmx_phys_to_ptr(CAST64(ptr_offset) &lt;&lt; bit_shift)))</span>
00563 <span class="preprocessor"></span>
<a name="l00564"></a><a class="code" href="cvm-common-defs_8h.html#a81">00564</a> <span class="preprocessor">#define CVM_PTR_TO_OFFSET(ptr, bit_shift) \</span>
00565 <span class="preprocessor">        ((uint32_t)(CAST64(cvmx_ptr_to_phys(ptr)) &gt;&gt; bit_shift))</span>
00566 <span class="preprocessor"></span>
00567 
00568 <span class="comment">/* stirct aliasing macros */</span>
<a name="l00569"></a><a class="code" href="cvm-common-defs_8h.html#a91">00569</a> <span class="keyword">typedef</span> uint8_t  uint8_all_alias   <a class="code" href="cvm-common-defs_8h.html#a91">__attribute__</a> ((may_alias));
00570 <span class="keyword">typedef</span> uint16_t uint16_all_alias  <a class="code" href="cvm-common-defs_8h.html#a91">__attribute__</a> ((may_alias));
00571 <span class="keyword">typedef</span> uint32_t uint32_all_alias  <a class="code" href="cvm-common-defs_8h.html#a91">__attribute__</a> ((may_alias));
00572 <span class="keyword">typedef</span> uint64_t uint64_all_alias  <a class="code" href="cvm-common-defs_8h.html#a91">__attribute__</a> ((may_alias));
00573 
00574 <span class="preprocessor">#endif </span><span class="comment">/* __CVM_COMMON_DEFS_H__ */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Oct 25 14:15:48 2011 for Octeon Common Component by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
