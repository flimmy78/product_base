<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Octeon PCI Driver: OCTEON PCI Host Test Programs</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<h1><a class="anchor" name="test-main">OCTEON PCI Host Test Programs</a></h1>The PCI base driver package includes sample programs to demonstrate usage of the input and output queues and the PCI DMA engines of OCTEON using the PCI driver.<p>
The following kernel-space applications are available:<p>
1. req_resp - Provides a linux kernel module that uses the API's exported by the driver for request processing to send requests to the OCTEON cores. It requires the cvmcs core application to respond to the requests it sends.<p>
2. droq_test - Provides a linux kernel module that registers dispatch functions for a set of pre-defined opcodes. It required the cvmcs core application to send packets on the PCI output queues with these opcodes.<p>
There is also a user-space application:<p>
1. oct_req - It uses the user api's from the host api library to send requests to the OCTEON cores. It requires the cvmcs core application to respond to the requests it sends.<p>
<br>
<br>
<br>
 <h2><a class="anchor" name="core_app">
Core application (cvmcs)</a></h2>
All the test programs running on the PCI host require the <b>cvmcs</b> core application. The sources for this application is located at OCTEON-SDK/applications/pci-core-app.<p>
The main initialization routines can be found in pci-core-app/base and pci-core-app/common. All test routines are available from pci-core-app/test.<p>
The application can be compiled to perform one or more type of tests at a given time. The type of tests that the application runs is determined by the definitions in pci-core-app/test/cvmcs-test.h file.<p>
By default, the application will process requests with opcode CVMCS_REQRESP_OP. If a response is required (the rptr field in PCI instruction will be non-zero), the application copies the input bytes into the output buffers and sends a response back to the host. If the output buffer is bigger than the input, it fills the remaining output bytes with a signature value (0xFA currently). The host application (either the req_resp kernel application or oct_req user-space application) can compare the input and output buffer contents to see if the operation was successful.<p>
The application also supports scatter mode responses. The cvmcs-reqresp.c file has routines to read a scatter list in blocking and non-blocking mode and to send back a scatter response. The application exercises all scatter mode API depending on the flags enabled in cvmcs-test.h. The source is well-documented and should be self-explanatory. See the core driver html documentation for more details on the core driver API.<p>
The following definitions in cvmcs-test.h enable other functions:<p>
<ul>
<li>CVMCS_TEST_PKO - Enable this to send test packets on the output queues with opcodes DROQ_PKT_OP1 and DROQ_PKT_OP2. This option is useful when running the <b>droq_test</b> kernel space program. The test allows test to be sequentially increasing upto CMV_MAX_DATA, fixed at CVM_MAX_DATA or random sizes from 1 to CVM_MAX_DATA for each test packet send to host via PKO.</li>
</ul>
<ul>
<li>CVM_MAX_DATA - The packets sent to output queue will not be greater than CVM_MAX_DATA in size.</li>
</ul>
To compile the <b>cvmcs</b> program, do make in OCTEON-SDK/applications/pci-core-app/base. A symbolic link is created from OCTEON-SDK/components/driver/bin to the core application.<p>
<br>
<br>
 <h2><a class="anchor" name="user_space_app">
User space test program</a></h2>
<b> 1. oct_req - test request/response </b><p>
The user space test program, called <b>oct_req</b>, uses the user space library api to send RAW PCI instructions to OCTEON. It requires the core application <b>cvmcs</b> to be running on OCTEON cores for its operation.<p>
The source for <b>oct_req</b> is at OCTEON-SDK/components/driver/host/test.<p>
<b>oct_req</b> can be used to send requests of UNORDERED and NORESPONSE types. The operations can be blocking or non-blocking. The test parameters can be modified in the file oct_req.c. The type of request and request mode can also be specified on the command line. The command line arguments override any settings made in oct_req.c. The default settings in oct_req.c is to send NORESPONSE/NON-BLOCKING type requests in DIRECT DMA mode.<p>
Command line options: <ul>
<li>-d : Change the DMA mode to use for the request. Supported values are "direct", "gather", "scatter" and "scatter_gather". </li>
<li>-u : Send requests of UNORDERED response order. </li>
<li>-b : Send a blocking mode request. </li>
<li>-s : Do not print per-packet messages. </li>
<li>-y : Answer "yes" to all prompts. </li>
<li>[count] - Number of requests to send. If specified, the test will attempts to send <b>count</b> requests and stop, else it will continue to run till stopped (Press ^C to stop).</li>
</ul>
To compile the <b>oct_req</b> program, do make in OCTEON-SDK/components/driver/host/test. A symbolic link is created from OCTEON-SDK/components/driver/bin to the application.<p>
How to test: <div class="fragment"><pre class="fragment">    1. Load the driver and OCTEON application by following the instructions in
       OCTEON-SDK/components/driver/README.txt.

    2. Load the test application
    cmd&gt; ./oct_req -ubsy   # Starts the test with unordered/blocking requests.

    </pre></div><p>
<br>
<br>
<br>
 <h2><a class="anchor" name="kern_space_app">
Kernel space test applications</a></h2>
<b> 1. req_resp - test request/response </b><p>
The kernel space test program, <b>req_resp</b>, calls driver API's to send requests to OCTEON. It requires the core application <b>cvmcs</b> to be running on the OCTEON cores for its operation.<p>
The source for <b>req_resp</b> is at OCTEON-SDK/components/driver/host/test/kernel/req_resp.<p>
<b>req_resp</b> can be used to send requests of ORDERED, UNORDERED and NORESPONSE types. It can send requests in both BLOCKING and NON-BLOCKING mode, though its not recommended to use the UNORDERED/NON-BLOCKING method. The default setting is to send ORDERED/BLOCKING requests. The test program provides a good reference to writing kernel mode applications that need to interface with the OCTEON PCI driver.<p>
The setting for the application can be changed in OCTEON_req_resp.c. Each parameter is documented in this file.<p>
To compile the <b>req_resp</b> program, do make in OCTEON-SDK/components/driver/host/test/kernel/req_resp. A symbolic link is created from OCTEON-SDK/components/driver/bin to the application.<p>
How to test: <div class="fragment"><pre class="fragment">    1. Load the driver and OCTEON application by following the instructions in
       OCTEON-SDK/components/driver/README.txt.

    2. Load the kernel application
    cmd&gt; insmod req_resp.ko

    </pre></div><p>
<br>
<br>
 <b> 2. droq_test - receive packets from output queue </b><p>
The kernel space test program, <b>droq_test</b>, registers dispatch functions to receive unsolicited packets arriving on the output queues. The <b>droq_test</b> program requires the <b>cvmcs</b> core application to be running on the OCTEON cores. The cvmcs application must be compiled with the CVMCS_TEST_PKO flag enabled.<p>
The source for <b>droq_test</b> is at OCTEON-SDK/components/driver/host/test/kernel/droq_test.<p>
The core application, when set accordingly, will generate packets with opcodes DROQ_PKT_OP1 &amp; DROQ_PKT_OP2, and send on the OCTEON output queue. The OCTEON PCI driver fetches these packets in its interrupt handler and looks for a dispatch function for these opcodes. If a function exists, the packet are sent to the dispatch function, else the packets are discarded.<p>
<b>droq_test</b> settings can be modied in the OCTEON_droq_test.c file. If DROQ_TEST_SEC_OPCODE is enabled, the application registers dispatch function for opcodes DROQ_PKT_OP1 and DROQ_PKT_OP2 with the driver, else a dispatch function is registered only for DROQ_PKT_OP1.<p>
To compile the <b>droq_test</b> program, do make in OCTEON-SDK/components/driver/host/test/kernel/droq_test. A symbolic link is created from OCTEON-SDK/components/driver/bin to the application.<p>
How to test: <div class="fragment"><pre class="fragment">    1. Load the driver and OCTEON application by following the instructions in
       OCTEON-SDK/components/driver/README.txt.

    2. Load the kernel application
    cmd&gt; insmod droq_test.ko

    </pre></div> <hr size="1"><address style="align: right;"><small>Generated on Tue Nov 22 15:41:00 2011 for Octeon PCI Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
