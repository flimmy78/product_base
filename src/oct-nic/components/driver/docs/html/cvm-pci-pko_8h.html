<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Octeon PCI Driver: cvm-pci-pko.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>cvm-pci-pko.h File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Core Driver: PKO initialization and packet send routines. 
<p>

<p>
Definition in file <a class="el" href="cvm-pci-pko_8h-source.html">cvm-pci-pko.h</a>.
<p>

<p>
<a href="cvm-pci-pko_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cvm-pci-pko_8h.html#a7739ae8f3552ffeaff8cde5e3eb6431">setup_pci_pko_ports</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Core: Sets up the map of PKO hardware port &amp; queues corresponding to the PCI output queues.  <a href="#a7739ae8f3552ffeaff8cde5e3eb6431"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cvm-pci-pko_8h.html#c5e166689b1d4f886e5bee1bac37fffb">cvm_pko_send_data</a> (<a class="el" href="unioncvmx__resp__hdr__t.html">cvmx_resp_hdr_t</a> *user_resp_hdr, cvmx_buf_ptr_t dptr, <a class="el" href="cvm-pci_8h.html#451d7a5c26a37002543c86c9b82dd203">cvm_ptr_type_t</a> ptr_type, uint32_t total_bytes, uint32_t segs, uint32_t port)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Core: Call this routine to send a data packet to the Octeon output queues.  <a href="#c5e166689b1d4f886e5bee1bac37fffb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cvm-pci-pko_8h.html#0729a4a8ff43bc9e6ac868728aab1c94">cvm_pko_send_direct</a> (cvmx_buf_ptr_t lptr, <a class="el" href="cvm-pci_8h.html#451d7a5c26a37002543c86c9b82dd203">cvm_ptr_type_t</a> ptr_type, uint32_t segs, uint32_t total_bytes, uint32_t port)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Core: The arguments have the same meaning as the <a class="el" href="cvm-pci-pko_8h.html#c5e166689b1d4f886e5bee1bac37fffb">cvm_pko_send_data()</a> API above.  <a href="#0729a4a8ff43bc9e6ac868728aab1c94"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cvm-pci-pko_8h.html#4bbe352229e68fe5e5435e6b36e8b2e1">cvm_pko_send_direct_flags</a> (cvmx_buf_ptr_t lptr, <a class="el" href="cvm-pci_8h.html#451d7a5c26a37002543c86c9b82dd203">cvm_ptr_type_t</a> ptr_type, uint32_t segs, uint32_t total_bytes, uint32_t port, uint32_t flags, uint64_t flag_data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Core: The first 5 parameters have the same meaning as <a class="el" href="cvm-pci-pko_8h.html#c5e166689b1d4f886e5bee1bac37fffb">cvm_pko_send_data()</a> API above.  <a href="#4bbe352229e68fe5e5435e6b36e8b2e1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cvm-pci-pko_8h.html#07c3ff4a36b0bddb66bac5cd8bcf81d3">cvm_send_pci_pko_direct</a> (cvmx_buf_ptr_t lptr, <a class="el" href="cvm-pci_8h.html#451d7a5c26a37002543c86c9b82dd203">cvm_ptr_type_t</a> ptr_type, uint32_t segs, uint32_t total_bytes, uint32_t oq_no)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Core: The arguments have the same meaning as the <a class="el" href="cvm-pci-pko_8h.html#0729a4a8ff43bc9e6ac868728aab1c94">cvm_pko_send_direct()</a> API above.  <a href="#07c3ff4a36b0bddb66bac5cd8bcf81d3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cvm-pci-pko_8h.html#0de63c1ddb7beb5b1b769d992c9e34d9">cvm_pci_get_oq_pkoport</a> (int oq)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Core: Get the PKO hardware port number corresponding to the PCI output queue number passed as argument.  <a href="#0de63c1ddb7beb5b1b769d992c9e34d9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cvm-pci-pko_8h.html#d29b6baa20b38f50293457d74e7fafef">cvm_pci_get_oq_pkoqueue</a> (int oq)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Core: Get the PKO hardware queue number corresponding to the PCI output queue number passed as argument.  <a href="#d29b6baa20b38f50293457d74e7fafef"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="0de63c1ddb7beb5b1b769d992c9e34d9"></a><!-- doxytag: member="cvm-pci-pko.h::cvm_pci_get_oq_pkoport" ref="0de63c1ddb7beb5b1b769d992c9e34d9" args="(int oq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cvm_pci_get_oq_pkoport           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>oq</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Core: Get the PKO hardware port number corresponding to the PCI output queue number passed as argument. 
<p>

</div>
</div><p>
<a class="anchor" name="d29b6baa20b38f50293457d74e7fafef"></a><!-- doxytag: member="cvm-pci-pko.h::cvm_pci_get_oq_pkoqueue" ref="d29b6baa20b38f50293457d74e7fafef" args="(int oq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cvm_pci_get_oq_pkoqueue           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>oq</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Core: Get the PKO hardware queue number corresponding to the PCI output queue number passed as argument. 
<p>

</div>
</div><p>
<a class="anchor" name="c5e166689b1d4f886e5bee1bac37fffb"></a><!-- doxytag: member="cvm-pci-pko.h::cvm_pko_send_data" ref="c5e166689b1d4f886e5bee1bac37fffb" args="(cvmx_resp_hdr_t *user_resp_hdr, cvmx_buf_ptr_t dptr, cvm_ptr_type_t ptr_type, uint32_t total_bytes, uint32_t segs, uint32_t port)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cvm_pko_send_data           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="unioncvmx__resp__hdr__t.html">cvmx_resp_hdr_t</a> *&nbsp;</td>
          <td class="paramname"> <em>user_resp_hdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cvmx_buf_ptr_t&nbsp;</td>
          <td class="paramname"> <em>dptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cvm-pci_8h.html#451d7a5c26a37002543c86c9b82dd203">cvm_ptr_type_t</a>&nbsp;</td>
          <td class="paramname"> <em>ptr_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>total_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>segs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>port</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Core: Call this routine to send a data packet to the Octeon output queues. 
<p>
For a linked mode or direct mode data, this routine adds another buffer to the start of the linked list into which the response header is copied. For a gather mode data sent by user, this routine creates a new gather list and makes the user response header the first element of the gather list. Needless to say, if performance is important, you should make space to add 8 bytes of response header before your data and call cvm_pko_post_command() directly.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>user_resp_hdr</em>&nbsp;</td><td>- the response header that identifies the user data. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dptr</em>&nbsp;</td><td>- pointer to the user data. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ptr_type</em>&nbsp;</td><td>- type of data pointed by dptr( linked/gather/direct) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>total_bytes</em>&nbsp;</td><td>- amount of user data (excludes response header) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>segs</em>&nbsp;</td><td>- number of user buffers (in linked and gather mode) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>- PKO port on which to send data ( 32 &lt;= port &lt;= 35)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Success: returns 0, else 1. </dd></dl>

</div>
</div><p>
<a class="anchor" name="0729a4a8ff43bc9e6ac868728aab1c94"></a><!-- doxytag: member="cvm-pci-pko.h::cvm_pko_send_direct" ref="0729a4a8ff43bc9e6ac868728aab1c94" args="(cvmx_buf_ptr_t lptr, cvm_ptr_type_t ptr_type, uint32_t segs, uint32_t total_bytes, uint32_t port)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cvm_pko_send_direct           </td>
          <td>(</td>
          <td class="paramtype">cvmx_buf_ptr_t&nbsp;</td>
          <td class="paramname"> <em>lptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cvm-pci_8h.html#451d7a5c26a37002543c86c9b82dd203">cvm_ptr_type_t</a>&nbsp;</td>
          <td class="paramname"> <em>ptr_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>segs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>total_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>port</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Core: The arguments have the same meaning as the <a class="el" href="cvm-pci-pko_8h.html#c5e166689b1d4f886e5bee1bac37fffb">cvm_pko_send_data()</a> API above. 
<p>
This API assumes that 8 bytes of response header is available at the start of the first buffer pointed by lptr.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lptr</em>&nbsp;</td><td>- Pointer to data or gather buffer in Octeon's local memory. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ptr_type</em>&nbsp;</td><td>- Describes the type of buffer available at dptr. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>segs</em>&nbsp;</td><td>- Number of buffers. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>total_bytes</em>&nbsp;</td><td>- Sum of data bytes from all buffers. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>- PKO port on which to send data ( 32 &lt;= port &lt;= 35)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Success: 0; Failure: 1. </dd></dl>

</div>
</div><p>
<a class="anchor" name="4bbe352229e68fe5e5435e6b36e8b2e1"></a><!-- doxytag: member="cvm-pci-pko.h::cvm_pko_send_direct_flags" ref="4bbe352229e68fe5e5435e6b36e8b2e1" args="(cvmx_buf_ptr_t lptr, cvm_ptr_type_t ptr_type, uint32_t segs, uint32_t total_bytes, uint32_t port, uint32_t flags, uint64_t flag_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cvm_pko_send_direct_flags           </td>
          <td>(</td>
          <td class="paramtype">cvmx_buf_ptr_t&nbsp;</td>
          <td class="paramname"> <em>lptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cvm-pci_8h.html#451d7a5c26a37002543c86c9b82dd203">cvm_ptr_type_t</a>&nbsp;</td>
          <td class="paramname"> <em>ptr_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>segs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>total_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>flag_data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Core: The first 5 parameters have the same meaning as <a class="el" href="cvm-pci-pko_8h.html#c5e166689b1d4f886e5bee1bac37fffb">cvm_pko_send_data()</a> API above. 
<p>
This API also assumes that 8 bytes of response header is available at the start of the first buffer. In addition, the flags parameter is used to pass additional flags. The flags_data parameter provides additional information when flags is non-zero. Currently flags is reserved for use by the driver and should always be set to zero.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lptr</em>&nbsp;</td><td>- Pointer to data or gather buffer in Octeon's local memory. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ptr_type</em>&nbsp;</td><td>- Describes the type of buffer available at dptr. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>segs</em>&nbsp;</td><td>- Number of buffers. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>total_bytes</em>&nbsp;</td><td>- Sum of data bytes from all buffers. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>- PKO port on which to send data ( 32 &lt;= port &lt;= 35) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>- additional flags. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flag_data</em>&nbsp;</td><td>- data associated with the flags.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Success: 0; Failure: 1. </dd></dl>

</div>
</div><p>
<a class="anchor" name="07c3ff4a36b0bddb66bac5cd8bcf81d3"></a><!-- doxytag: member="cvm-pci-pko.h::cvm_send_pci_pko_direct" ref="07c3ff4a36b0bddb66bac5cd8bcf81d3" args="(cvmx_buf_ptr_t lptr, cvm_ptr_type_t ptr_type, uint32_t segs, uint32_t total_bytes, uint32_t oq_no)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cvm_send_pci_pko_direct           </td>
          <td>(</td>
          <td class="paramtype">cvmx_buf_ptr_t&nbsp;</td>
          <td class="paramname"> <em>lptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cvm-pci_8h.html#451d7a5c26a37002543c86c9b82dd203">cvm_ptr_type_t</a>&nbsp;</td>
          <td class="paramname"> <em>ptr_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>segs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>total_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>oq_no</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Core: The arguments have the same meaning as the <a class="el" href="cvm-pci-pko_8h.html#0729a4a8ff43bc9e6ac868728aab1c94">cvm_pko_send_direct()</a> API above. 
<p>
This API assumes that 8 bytes of response header is available at the start of the first buffer pointed by lptr. The oq_no corresponds to the PCI output queue ring number (not the PCI port) and ranges from 0 to 31. This API can be used when you have more than 1 output queue ring per PCI port to target the output queue directly. The previous API.s always sent to the first queue in the PCI port. Additional setup is required before using this API.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lptr</em>&nbsp;</td><td>- Pointer to data or gather buffer in Octeon's local memory. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ptr_type</em>&nbsp;</td><td>- Describes the type of buffer available at dptr. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>segs</em>&nbsp;</td><td>- Number of buffers. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>total_bytes</em>&nbsp;</td><td>- Sum of data bytes from all buffers. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>oq_no</em>&nbsp;</td><td>- The PCI output queue to send this data.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Success: 0; Failure: 1. </dd></dl>

</div>
</div><p>
<a class="anchor" name="a7739ae8f3552ffeaff8cde5e3eb6431"></a><!-- doxytag: member="cvm-pci-pko.h::setup_pci_pko_ports" ref="a7739ae8f3552ffeaff8cde5e3eb6431" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int setup_pci_pko_ports           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Core: Sets up the map of PKO hardware port &amp; queues corresponding to the PCI output queues. 
<p>
<dl compact><dt><b>Returns:</b></dt><dd>Success: 0; Failure: 1. </dd></dl>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Tue Nov 22 15:40:59 2011 for Octeon PCI Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
