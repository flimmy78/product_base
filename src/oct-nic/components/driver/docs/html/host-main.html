<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Octeon PCI Driver: OCTEON Host driver</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<h1><a class="anchor" name="host-main">OCTEON Host driver</a></h1><br>
 <h2><a class="anchor" name="hm-sec1">
Introduction</a></h2>
The OCTEON host PCI driver allows user-applications to interact with OCTEON device by providing a means to send requests to the OCTEON input ports and to forward the responses received from OCTEON. The driver provides both blocking and non-blocking call support to send requests. It also lets applications (kernel only) to register callbacks that the driver calls after request completion. The driver also has a dispatch mechanism by which a kernel application interested in unsolicited output from OCTEON can register with the driver to receive those packets.<p>
<br>
 <h2><a class="anchor" name="hm-sec2">
OCTEON Input Queues.</a></h2>
<dl compact><dt><b>See also:</b></dt><dd>request_manager.c OCTEON_iq.h</dd></dl>
The OCTEON device provides input queues to send data from host to OCTEON. An application can send requests to the driver using the soft_request structure. The driver forwards it to OCTEON as an instruction. The driver is responsible for posting the request, waiting for its response (if expected) and returning it to the caller, or if the request times-out to notify the caller about it. A poll thread in the driver keeps track of requests for time-out.<p>
More detailed discussion on sending requests to OCTEON can be found at <a href="reqresp.html">Request processing using the OCTEON PCI driver</a>.<p>
<br>
 <h2><a class="anchor" name="hm-sec3">
OCTEON Output queues</a></h2>
<dl compact><dt><b>See also:</b></dt><dd>OCTEON_droq.c OCTEON_main.c</dd></dl>
The PCI output queues in OCTEON allow data to be forwarded from OCTEON to host. Each of these queues is implemented as a descriptor ring in the host memory with each descriptor pointing to a data buffer and optionally an info pointer. All data buffers in the descriptor ring are of the same size. OCTEON can push data into these queues while taking care of splitting the data and writing it into consecutive buffers. OCTEON can also write a fixed number of bytes of data along with the length of data to the Info pointer and write the rest to the data buffer(s). Note that only the info pointer of the first descriptor carries the additional data for packets that requires multiple descriptors. OCTEON interrupts the host once a set number of packets has been sent to the host or a time threshold has been reached.<p>
More detailed discussion on receiving data packets from OCTEON can be found at <a href="oq-main.html">OCTEON Driver Output Operation </a>.<p>
<br>
 <h2><a class="anchor" name="hm-sec4">
Hot Reset</a></h2>
<dl compact><dt><b>See also:</b></dt><dd>OCTEON_device.c</dd></dl>
Hot Reset of a OCTEON target device allows a reset of the OCTEON device without having to unload the OCTEON device driver. Hot reset can be performed even when other modules like the NIC or CNTQ are loaded. When any such module is loaded, the base driver ensures that these modules can be put to a quiet state before doing a reset. If not, the reset is aborted. Before performing a reset, the base driver also waits all pending requests to complete and brings the input and output queues to a quiesced state. Once the reset is done, a new core application can be loaded and the driver can be used to communicate with OCTEON.<p>
To perform hot reset, you will need the oct_dbg utility. Compile the sources in OCTEON-SDK/components/driver/host/utils/oct_dbg.c. Select option 't' to initiate a Hot Reset. Check the system log messages to see if the reset completed successfully.<p>
<br>
 <h2><a class="anchor" name="hm-sec5">
OCTEON DMA Engines</a></h2>
OCTEON provides general purpose DMA engines which can be used by core software to DMA data from or to the host. These engines are used by the core driver to copy the response for instructions directly into host memory.<p>
The API's for sending responses and for PCI DMA read/write operations are discussed in more detail at <a href="core-main.html">OCTEON Core PCI Driver component</a>.<p>
<br>
<br>
 <h2><a class="anchor" name="hm-sec7">
OCTEON device identifier</a></h2>
The driver can support multiple OCTEON devices in a single instance. The maximum OCTEON devices supported is determined by the MAX_OCTEON_DEVICES setting in components/driver/host/include/OCTEON_config.h.<p>
Each OCTEON device in the system is assigned an id starting with 0 for the first OCTEON device. The driver configures devices in the order it is passed to it by the PCI subsystem in the linux kernel. Usually, this matches the order of devices in the PCI bus scan.<p>
<br>
<br>
<p>
<a class="anchor" name="Octdevconf"></a> <h2><a class="anchor" name="hm-sec8">
OCTEON device configuration</a></h2>
The OCTEON device configuration is maintained by the driver in <a class="el" href="oct__config__data_8h.html">oct_config_data.h</a>. This header file includes a default configuration for every OCTEON processor family. The configuration data is maintained in statically initialized data structures using the data types defined in OCTEON_config.h.<p>
If you want to change the default configuration, you can modify the values in these configuration data structures. This will affect all OCTEON devices of the same type (for e.g. if you modify the CN56XX configuration, all CN56XX devices in the system will have the same new configuration).<p>
If you wish to use a custom configuration for a particular OCTEON device, follow the procedure outlined below:<ul>
<li>Create a copy of the default configuration data corresponding to the OCTEON processor family of interest. Lets call this new configuration as custom_conf.</li><li>Open components/driver/host/driver/osi/OCTEON_device.c and modify the oct_conf_info structure.<ul>
<li>Change the conf_type field for the OCTEON that you wish to customize from OCTEON_CONFIG_TYPE_DEFAULT to OCTEON_CONFIG_TYPE_CN3XXX_CUSTOM for a CN38XX/CN58XX device, OCTEON_CONFIG_TYPE_CN56XX_CUSTOM for a CN56XX device or OCTEON_CONFIG_TYPE_CN63XX_CUSTOM for a CN63XX device.</li><li>Change the custom field to the address of the custom_conf structure.</li></ul>
</li></ul>
<p>
<br>
<p>
<br>
<br>
 <h2><a class="anchor" name="hm-sec9">
The /proc entries</a></h2>
The driver creates entries in the /proc filesystem for each OCTEON device in the system. The /proc entries identifies each OCTEON device by its id. For e.g., entries for the first OCTEON (with device id 0), will be under /proc/OCTEON0.<p>
The following files can be found for each OCTEON device:<ul>
<li><b>/proc/OCTEONX/configreg (ReadOnly)</b> dumps the config space registers for the device.</li><li><b>/proc/OCTEONX/csrreg (ReadOnly)</b> dumps the BAR0 CSR registers for the device.</li><li><b>/proc/OCTEONX/status (ReadOnly)</b> dumps the status of each Input and Output Queue including the current position of indexes and the register values associated with each queue.</li><li><b>/proc/OCTEONX/stats (ReadOnly)</b> dumps the statistics for each Input and Output Queue, including the number of packets, total bytes and bytes since the last time this field was read.</li><li><b>/proc/OCTEONX/npireg (ReadOnly; exists for CN38XX/58XX devices only)</b> dumps the BAR0 PCI Windowed registers for the device.</li></ul>
<p>
<br>
<br>
 <h2><a class="anchor" name="hm-secc">
Compiling the Host driver</a></h2>
Steps to compile the host driver can be found at OCTEON-SDK/components/driver/README.txt.<h2><a class="anchor" name="hm-deprec">
Deprecation Notice</a></h2>
The following items have been deprecated/changed from the driver sources in the 1.0.0 release.<p>
<ul>
<li>OCTEON_soft_request_t : The changes are described in <a class="el" href="reqresp.html#octsoftreqformat">Soft request structure changes</a></li></ul>
<p>
<ul>
<li>CN56XX_WORKAROUND : This flag was used to enable support for CN56XX Pass1 and is now deprecated. </li></ul>
<hr size="1"><address style="align: right;"><small>Generated on Tue Nov 22 15:41:00 2011 for Octeon PCI Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
